<view>
    <!-- <popform></popform> -->
    <view class="fixed-block">
        <view class="select-section">
            <view class="flex select-order">
                <view bindtap='getOrderData' data-task_type="1" class="{{params.task_type == 1 ? 'selected' : ''}}">找料订单</view>
                <view bindtap='getOrderData' data-task_type="2" class="{{params.task_type == 2 ? 'selected' : ''}}">取料订单</view>
            </view>
            <view wx:if="{{params.task_type == 1}}" class="flex status-section">
                <view bindtap='getOrderTypeData' data-type="0" class="{{params.type == 0 ? 'selected' : ''}}">全部</view>
                <view bindtap='getOrderTypeData' data-type="1" class="{{params.type == 1 ? 'selected' : ''}}">找料中</view>
                <view bindtap='getOrderTypeData' data-type="2" class="{{params.type == 2 ? 'selected' : ''}}">配送中</view>
                <view bindtap='getOrderTypeData' data-type="3" class="{{params.type == 3 ? 'selected' : ''}}">已完成</view>
            </view>
            <view wx:elif="{{params.task_type == 2}}" class="flex status-section">
                <view bindtap='getOrderTypeData' data-type="0" class="{{params.type == 0 ? 'selected' : ''}}">全部</view>
                <view bindtap='getOrderTypeData' data-type="2" class="{{params.type == 2 ? 'selected' : ''}}">配送中</view>
                <view bindtap='getOrderTypeData' data-type="3" class="{{params.type == 3 ? 'selected' : ''}}">已完成</view>
            </view>
        </view>
    </view>

    <view class="item-container">
        <!-- 订单数据为空 -->
        <view class="empty" wx:if="{{isShow && orderList.length === 0}}">
            <image src="../../images/empty.png"></image>
            <view class="tc">
                <text class="c999 fs34">您还没有相关订单</text>
            </view>
        </view>

        <view wx:elif="{{isShow &&orderList.length !== 0}}">

            <block wx:for="{{orderList}}" wx:for-index="index" wx:for-item="item" wx:key="key">

                <view class="order-item">
                    <navigator data-index="{{index}}" open-type='navigate' url="../orderDetail/orderDetail?index={{index}}" class="flex order-status relative">
                        <view>
                            <view>
                                订单编号：{{item.id}}
                            </view>
                            <view>
                                下单时间：{{item.created_at}}
                            </view>
                        </view>
                        <view class="ctheme">
                            {{item.button_status.red_title}}
                        </view>

                        <view wx:if="{{index === 0}}" class="new" style="position:absolute;right:-2rpx;;top:-2rpx;z-index:10;">
                            <image style="width:50rpx;height:50rpx;" src="../../images/new-1.png"></image>
                        </view>
                    </navigator>
                    <view class="order-info">
                        <view class="order-info-left">

                            <view class="flex align-item-start">
                                <view class="flex-1">
                                    <view>
                                        物料品类： {{item.cname}}
                                    </view>
                                    <view class="ellipsis">
                                        物料描述： {{item.desc}}
                                    </view>

                                    <view wx:if="{{item.type === 1}}">提供找料方式： 按图找料</view>
                                    <view wx:if="{{item.type === 2}}">提供找料方式： 按样找料</view>
                                    <view wx:if="{{item.type === 3}}">提供找料方式： 按描述找料</view>

                                </view>

                                <view class="order-info-right">
                                    <image wx:if="{{item.is_prompt === 1}}" src="../../images/reminder.png"></image>
                                    <image wx:else src="{{params.task_type == 1 ? '../../images/find.png': '../../images/send.png'}}" />
                                </view>

                            </view>
                            <!--图片找料  -->
                            <view wx:if="{{item.type === 1}}">
                                <view class="order-pics-list">
                                    <!-- <image wx:if="{{item.front_img.length !== 0}}" src="{{item.front_img}}" />
                                    <image wx:if="{{item.side_img.length !== 0}}" src="{{item.side_img}}" />
                                    <image wx:if="{{item.back_img.length !== 0}}" src="{{item.back_img}}" /> -->
                                    <image bindtap='preview' wx:for="{{item.imgs}}" src="{{img}}" wx:for-item="img" wx:for-index="idx" data-idx="{{idx}}" data-index="{{index}}" wx:key="{{idx}}"></image>
                                </view>
                            </view>
                            <!--按样取样  -->

                            <view class="address-space" wx:if="{{item.type === 2}}">
                                <!--档口名称  -->
                                <view class="flex align-item-start">
                                    <view>
                                        档口名称：
                                    </view>
                                    <view class="flex-1">
                                        <view class="ellipsis">{{item.get_address.stall}}</view>
                                    </view>
                                </view>
                                <!--联系人  -->
                                <view class="flex align-item-start">
                                    <view>
                                    　联系人：
                                    </view>
                                    <view class="flex-1">
                                        <view class="ellipsis">{{item.get_address.consignee}} {{item.get_address.mobile}}</view>
                                    </view>
                                </view>
                                <!--取料地址  -->
                                <view class="flex align-item-start">
                                    <view>
                                        取料地址：
                                    </view>
                                    <view class="flex-1">
                                        <view class="ellipsis-line2"> {{ item.get_address.city_str}} {{ item.get_address.address}}</view>
                                    </view>
                                </view>

                            </view>
                            <!--邮寄送料地址  -->

                            <view  class="address-space">

                                <view class="flex align-item-start">
                                    <view>档口名称：</view>
                                    <view class="flex-1">
                                        {{item.shipping_address.stall}}
                                    </view>
                                </view>

                                <view class="flex align-item-start">
                                    <view>　联系人：</view>
                                    <view class="flex-1">
                                        <view class="ellipsis">{{item.shipping_address.consignee}} {{item.shipping_address.mobile}}</view>
                                    </view>
                                </view>

                                <view class="flex align-item-start">
                                    <view>送料地址：</view>
                                    <view class="flex-1">
                                        <view class="ellipsis-line2"> {{ item.shipping_address.city_str}} {{ item.shipping_address.address}}</view>
                                    </view>
                                </view>

                            </view>
                        </view>

                    </view>
                    <!--按钮  -->
                    <view class="flex  order-handle">
                        <view class="c-blue invisible">
                            <text class="iconfont icon-kehu mgr10" />客户催单
                        </view>
                        <!--找料中  -->
                        <view wx:if="{{item.button_status.status === 1}}" class="flex find-status">
                            <view data-type='2' data-id="{{item.id}}" bindtap='showForm'>找不到物料</view>
                            <view data-type='1' data-id="{{item.id}}" bindtap='showForm' class="ctheme warm-border">找到物料</view>
                        </view>
                        <!--配送中状态  -->
                        <view wx:if="{{item.button_status.status === 2}}" class="flex find-status">
                            <view data-type='3' data-id="{{item.id}}" bindtap='showForm' class="ctheme warm-border">确认送达</view>
                        </view>
                        <!--已经完成状态  -->
                        <navigator data-index="{{index}}" data-id="{{item.id}}" open-type='navigate' url="../orderDetail/orderDetail?index={{index}}" wx:if="{{item.button_status.status === 3}}" class="flex find-status">
                            <view>详情</view>
                        </navigator>
                    </view>
                </view>
            </block>

            <view wx:if="{{isFullLoad}}" class="tc fs24 c999 bg-base lh60 b600">
                已经全部加载完毕
            </view>
        </view>

        <!--骨架  -->
        <view wx:else>
            <view wx:for="{{[1,2]}}" wx:key="{{i}}" class="item-shell">
                <view class="item-shell-title">
                    <view></view>
                </view>

                <view class="item-shell-body">

                    <view class="w400"></view>
                    <view class="w500"></view>
                    <view class="w600"></view>
                    <view class="w300"></view>
                </view>

                <view class="item-shell-foot flex flex-end">
                    <view></view>
                </view>
            </view>
        </view>

    </view>
</view>


<view wx:if="{{formshow}}" class="pop-window" catchtouchmove="preventD">
    <!-- 填写档口 -->
    <view wx:if="{{formtype === '1'}}" class="form-box-1">
        <text bindtap='close' class="iconfont icon-guanbi close"></text>
        <form bindsubmit="formSubmit1" report-submit>
            <view class="fs34 b600 bdb lh120">请填写档口信息</view>
            <view class="flex tl bdb">
                <view class="mgr20">
                    <text class="ctheme">*</text>档口信息: </view>
                <input name="name" class="flex-1" confirm-hold="true" confirm-type="next" placeholder='请填写档口名称'></input>
            </view>
            <view class="flex tl bdb">
                <view class="mgr20">
                    <text class="ctheme">*</text>　联系人: </view>
                <input name="contacts" class="flex-1" confirm-hold="true" confirm-type="next" placeholder='请填写联系人'></input>
            </view>
            <view class="flex tl bdb">
                <view class="mgr20">
                    <text class="ctheme">*</text>联系电话: </view>
                <input name="phone" class="flex-1" confirm-hold="true" confirm-type="next" placeholder='请填写详细电话'></input>
            </view>
            <view class="flex tl bdb">
                <view class="mgr20">
                    <text class="ctheme">*</text>详细信息:
                </view>

                <view class="flex-1">
                    <view>
                        <picker style="flex:1;" mode="multiSelector" bindchange="bindMultiPickerChange" bindcolumnchange="bindMultiPickerColumnChange" value="{{multiIndex}}" range-key="region_name" range="{{[multiArray,multiArray[province].children, multiArray[province].children[city].children]}}">
                            <view class="picker" style="text-align:left;min-height:60rpx;line-height:60rpx;">
                                {{multiArray[multiIndex[0]].region_name}} {{multiArray[multiIndex[0]].children[multiIndex[1]].region_name}} {{multiArray[multiIndex[0]].children[multiIndex[1]].children[multiIndex[2]].region_name}}
                            </view>

                        </picker>
                    </view>
                    <input name="address" class="flex-1" confirm-type="done" placeholder='请填写详细地址'></input>
                </view>

            </view>
            <view class="submit-box">
                <button formType="submit">提交</button>
            </view>
        </form>
    </view>

    <!-- 填写找不到物料原因 -->
    <view wx:if="{{formtype === '2'}}" class="form-box-2" catchtouchmove="preventD">
        <text bindtap='close' class="iconfont icon-guanbi close"></text>
        <form bindsubmit="formSubmit2" report-submit>
            <view class="fs34 b600">填写找不到物料原因</view>
            <view class="fs24 lh36">（多次找不到物料，将影响绩效考核，请谨慎操作！）</view>
            <textarea class="tl reason bdb bdt" placeholder="请填写找不到物料的原因" name="remark" />
            <view class="submit-box">
                <button formType="submit">提交</button>
            </view>
        </form>
    </view>
    <!-- 回执信息 -->
    <view wx:if="{{formtype === '3'}}" class="form-box-3">
        <text bindtap='close' class="iconfont icon-guanbi close pd20"></text>
        <form bindsubmit="formSubmit3" report-submit>
            <view class="fs34 b600 bdb lh120">请填写回执信息</view>
            <view class="flex flex-start bdb form-add-img">
                <view>添加图片：</view>
                <view class="flex-1 pd20">

                    <view class="relative w200" wx:for="{{files}}">
                        <image bindtap='chooseImage' data-id="{{index}}" src="{{item.url}}" mode='aspectFill'></image>
                        <image data-id="{{index}}" catchtap='deleteItem' wx:if="{{item.pct}}" style="width:44rpx;height:44rpx;position:absolute;right:0;top:0rpx;background: transparent;z-index:999;" src='../../images/delete.png'></image>

                        <view wx:if="{{item.pct}}" style="width:200rpx;height:200rpx;background:rgba(0,0,0,0.4);position:absolute;left:0;top:0;text-align:center;line-height:200rpx;color:white;font-size:30rpx;">{{item.pct}}</view>
                        <input class="hidden" value="{{item.full_url}}" name="{{'img' + ( index +1 )}}" />
                    </view>

                </view>
            </view>
            <view class="flex tl bdb lh60">
                <view class="mgr20 lh80">
                    <text class="ctheme">*</text>回执信息: </view>
                <input class="flex-1" name="back_info" confirm-type="done" placeholder='请填写回执信息'></input>
            </view>
            <view class="submit-box">
                <button formType="submit">提交</button>
            </view>
        </form>
    </view>

</view>